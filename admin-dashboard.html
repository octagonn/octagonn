<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SpyderNet IT</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/light/style.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <div class="contact-item">
                    <i class="ph-light ph-shield-check"></i>
                    <span>Admin Portal - <span id="adminName">Loading...</span></span>
                </div>
            </div>
            <div class="top-bar-right">
                <button id="signOutBtn" class="text-link">
                    <i class="ph-light ph-sign-out"></i>
                    Sign Out
                </button>
            </div>
        </div>
    </div>
    
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="logo">
                <a href="admin-dashboard.html" class="logo-container">
                    <img src="img/spydernet-spider-logo-gradient.png" alt="SpyderNet Spider Logo" class="logo-spider">
                    <div class="logo-text-container">
                        <span class="logo-main-text">SpyderNet</span>
                        <span class="logo-sub-text">IT</span>
                        <span class="logo-tagline">Admin Dashboard</span>
                    </div>
                </a>
            </div>
            
            <!-- Global Search -->
            <div class="global-search">
                <div class="search-container">
                    <i class="ph-light ph-magnifying-glass"></i>
                    <input type="text" id="globalSearch" placeholder="Search tickets, customers, or contacts..." />
                    <div class="search-filters">
                        <button class="btn-icon" title="Search Filters">
                            <i class="ph-light ph-funnel"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="header-actions">
                <button id="createTicketBtn" class="btn btn-primary">
                    <i class="ph-light ph-plus"></i>
                    New Ticket
                </button>
                <a href="index.html" class="btn btn-secondary" target="_blank">
                    <i class="ph-light ph-globe"></i>
                    View Website
                </a>
            </div>
        </div>
    </header>

    <!-- Zendesk-style Layout -->
    <div class="admin-layout">
        <!-- Sidebar Navigation -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <!-- Dashboard Stats Summary -->
                <div class="sidebar-stats">
                    <div class="stats-summary">
                        <div class="stat-item">
                            <span class="stat-count" id="sidebarActiveTickets">0</span>
                            <span class="stat-label">Open Tickets</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-count" id="sidebarPendingContacts">0</span>
                            <span class="stat-label">Pending Contacts</span>
                        </div>
                    </div>
                </div>

                <!-- Ticket Views -->
                <div class="nav-section">
                    <h4 class="nav-section-title">Tickets</h4>
                    <ul class="nav-menu">
                        <li>
                            <button class="nav-item active" data-view="unsolved-tickets">
                                <i class="ph-light ph-ticket"></i>
                                <span>Your unsolved tickets</span>
                                <span class="count" id="unsolvedTicketsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="unassigned-tickets">
                                <i class="ph-light ph-user-minus"></i>
                                <span>Unassigned tickets</span>
                                <span class="count" id="unassignedTicketsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="all-tickets">
                                <i class="ph-light ph-stack"></i>
                                <span>All tickets</span>
                                <span class="count" id="allTicketsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="recently-solved">
                                <i class="ph-light ph-check-circle"></i>
                                <span>Recently solved</span>
                                <span class="count" id="recentlySolvedCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="pending-tickets">
                                <i class="ph-light ph-clock"></i>
                                <span>Pending tickets</span>
                                <span class="count" id="pendingTicketsCount">0</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Contact & Customer Views -->
                <div class="nav-section">
                    <h4 class="nav-section-title">Customers</h4>
                    <ul class="nav-menu">
                        <li>
                            <button class="nav-item" data-view="contact-submissions">
                                <i class="ph-light ph-envelope"></i>
                                <span>Contact submissions</span>
                                <span class="count" id="contactSubmissionsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="all-customers">
                                <i class="ph-light ph-users"></i>
                                <span>All customers</span>
                                <span class="count" id="allCustomersCount">0</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Appointment Views -->
                <div class="nav-section">
                    <h4 class="nav-section-title">Appointments</h4>
                    <ul class="nav-menu">
                        <li>
                            <button class="nav-item" data-view="upcoming-appointments">
                                <i class="ph-light ph-calendar"></i>
                                <span>Upcoming appointments</span>
                                <span class="count" id="upcomingAppointmentsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="cancellation-requests">
                                <i class="ph-light ph-calendar-x"></i>
                                <span>Cancellation requests</span>
                                <span class="count" id="cancellationRequestsCount">0</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-view="all-appointments">
                                <i class="ph-light ph-calendar-blank"></i>
                                <span>All appointments</span>
                                <span class="count" id="allAppointmentsCount">0</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="admin-main-content">
            <!-- View Header with Title and Actions -->
            <div class="view-header">
                <div class="view-title">
                    <h2 id="currentViewTitle">Your unsolved tickets</h2>
                    <span class="view-count" id="currentViewCount">0 tickets</span>
                </div>
                <div class="view-actions">
                    <div class="view-controls">
                        <button class="btn-icon" id="refreshCurrentView" title="Refresh">
                            <i class="ph-light ph-arrow-clockwise"></i>
                        </button>
                        <button class="btn-icon" title="View Options">
                            <i class="ph-light ph-dots-three"></i>
                        </button>
                    </div>
                    <div class="bulk-actions" style="display: none;">
                        <select class="bulk-action-select">
                            <option value="">Bulk actions</option>
                            <option value="mark-solved">Mark as solved</option>
                            <option value="assign">Assign to...</option>
                            <option value="priority">Change priority</option>
                            <option value="delete">Delete</option>
                        </select>
                        <button class="btn btn-secondary" id="applyBulkAction">Apply</button>
                    </div>
                </div>
            </div>

            <!-- Content Area (List View or Detail View) -->
            <div class="content-area">
                <!-- Ticket List View -->
                <div id="ticketListView" class="list-view active">
                    <div class="list-controls">
                        <div class="list-filters">
                            <div class="filter-group">
                                <select id="statusFilter" class="filter-select">
                                    <option value="">All statuses</option>
                                    <option value="new">New</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <select id="priorityFilter" class="filter-select">
                                    <option value="">All priorities</option>
                                    <option value="low">Low</option>
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        <div class="list-sort">
                            <select id="sortBy" class="filter-select">
                                <option value="created_at_desc">Latest first</option>
                                <option value="created_at_asc">Oldest first</option>
                                <option value="priority_desc">Priority (high to low)</option>
                                <option value="priority_asc">Priority (low to high)</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>

                    <!-- Tickets Table -->
                    <div class="tickets-table-container">
                        <table class="tickets-table">
                            <thead>
                                <tr>
                                    <th class="checkbox-col">
                                        <input type="checkbox" id="selectAllTickets">
                                    </th>
                                    <th class="id-col">ID</th>
                                    <th class="subject-col">Subject</th>
                                    <th class="requester-col">Requester</th>
                                    <th class="requested-col">Requested</th>
                                    <th class="type-col">Type</th>
                                    <th class="priority-col">Priority</th>
                                    <th class="status-col">Status</th>
                                    <th class="actions-col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ticketsTableBody">
                                <!-- Tickets will be loaded here -->
                            </tbody>
                        </table>
                        
                        <!-- Empty State -->
                        <div id="emptyState" class="empty-state" style="display: none;">
                            <div class="empty-state-content">
                                <i class="ph-light ph-ticket"></i>
                                <h3>No tickets found</h3>
                                <p>There are no tickets matching your current filter criteria.</p>
                                <button class="btn btn-primary" id="createFirstTicket">
                                    <i class="ph-light ph-plus"></i>
                                    Create your first ticket
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other List Views (contacts, customers, appointments) -->
                <div id="contactListView" class="list-view">
                    <!-- Contact submissions table will go here -->
                </div>
                
                <div id="customerListView" class="list-view">
                    <!-- Customers table will go here -->
                </div>
                
                <div id="appointmentListView" class="list-view">
                    <!-- Appointments table will go here -->
                </div>
            </div>
        </main>

        <!-- Ticket Detail Sidebar (Zendesk-style) -->
        <aside id="ticketDetailSidebar" class="ticket-detail-sidebar" style="display: none;">
            <div class="sidebar-header">
                <div class="ticket-info">
                    <h3 id="ticketDetailId">#12345</h3>
                    <span class="ticket-status-badge" id="ticketDetailStatus">Open</span>
                </div>
                <button class="btn-icon close-detail-sidebar">
                    <i class="ph-light ph-x"></i>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Customer Information -->
                <div class="sidebar-section">
                    <h4>Requester</h4>
                    <div class="customer-info">
                        <div class="customer-avatar">
                            <i class="ph-light ph-user-circle"></i>
                        </div>
                        <div class="customer-details">
                            <div class="customer-name" id="customerName">Customer Name</div>
                            <div class="customer-email" id="customerEmail">customer@email.com</div>
                            <div class="customer-phone" id="customerPhone">+1 (555) 123-4567</div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Properties -->
                <div class="sidebar-section">
                    <h4>Properties</h4>
                    <div class="properties-list">
                        <div class="property-item">
                            <label>Status</label>
                            <select id="ticketStatusSelect" class="property-select">
                                <option value="new">New</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="property-item">
                            <label>Priority</label>
                            <select id="ticketPrioritySelect" class="property-select">
                                <option value="low">Low</option>
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="property-item">
                            <label>Type</label>
                            <select id="ticketTypeSelect" class="property-select">
                                <option value="question">Question</option>
                                <option value="problem">Problem</option>
                                <option value="task">Task</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ticket Tags -->
                <div class="sidebar-section">
                    <h4>Tags</h4>
                    <div class="tags-container">
                        <div id="ticketTags" class="tags-list">
                            <!-- Tags will be added here -->
                        </div>
                        <input type="text" id="addTagInput" placeholder="Add tag..." class="tag-input">
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Ticket Detail Modal (full view) -->
    <div id="ticketDetailModal" class="modal" style="display: none;">
        <div class="modal-content ticket-detail-modal">
            <!-- Ticket Detail Header -->
            <div class="ticket-detail-header">
                <div class="ticket-title-section">
                    <h2 id="modalTicketSubject">Ticket Subject</h2>
                    <div class="ticket-meta">
                        <span class="ticket-id" id="modalTicketId">#12345</span>
                        <span class="ticket-created" id="modalTicketCreated">Created 2 hours ago</span>
                    </div>
                </div>
                <div class="ticket-actions">
                    <button class="btn btn-secondary" id="editTicketBtn">
                        <i class="ph-light ph-pencil-simple"></i>
                        Edit
                    </button>
                    <button class="modal-close btn-icon">
                        <i class="ph-light ph-x"></i>
                    </button>
                </div>
            </div>

            <!-- Ticket Detail Content -->
            <div class="ticket-detail-content">
                <!-- Conversation Area -->
                <div class="conversation-area">
                    <div class="conversation-header">
                        <h3>Conversation</h3>
                        <div class="conversation-controls">
                            <button class="btn-icon" title="Conversation settings">
                                <i class="ph-light ph-gear"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Messages List -->
                    <div id="conversationMessages" class="conversation-messages">
                        <!-- Messages will be loaded here -->
                    </div>

                    <!-- Reply Form -->
                    <div class="reply-form">
                        <div class="reply-header">
                            <div class="reply-type">
                                <button class="reply-type-btn active" data-type="public">
                                    <i class="ph-light ph-chat-circle"></i>
                                    Public reply
                                </button>
                                <button class="reply-type-btn" data-type="internal">
                                    <i class="ph-light ph-lock"></i>
                                    Internal note
                                </button>
                            </div>
                        </div>
                        <form id="replyForm" class="reply-form-content">
                            <div class="reply-editor">
                                <textarea id="replyMessage" placeholder="Leave a comment..." rows="4"></textarea>
                            </div>
                            <div class="reply-actions">
                                <div class="reply-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="solveTicket">
                                        <span>Submit as solved</span>
                                    </label>
                                </div>
                                <div class="reply-submit">
                                    <button type="button" class="btn btn-secondary">Save as draft</button>
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Sidebar with customer info and properties -->
                <div class="ticket-detail-sidebar-content">
                    <!-- Customer Card -->
                    <div class="customer-card">
                        <div class="customer-header">
                            <div class="customer-avatar">
                                <i class="ph-light ph-user-circle"></i>
                            </div>
                            <div class="customer-info">
                                <h4 id="modalCustomerName">Customer Name</h4>
                                <span id="modalCustomerEmail">customer@email.com</span>
                            </div>
                        </div>
                        <div class="customer-details">
                            <div class="detail-item">
                                <i class="ph-light ph-phone"></i>
                                <span id="modalCustomerPhone">+1 (555) 123-4567</span>
                            </div>
                            <div class="detail-item">
                                <i class="ph-light ph-map-pin"></i>
                                <span id="modalCustomerLocation">Location</span>
                            </div>
                        </div>
                        <div class="customer-actions">
                            <button class="btn btn-secondary btn-sm">
                                <i class="ph-light ph-user"></i>
                                View profile
                            </button>
                        </div>
                    </div>

                    <!-- Ticket Properties -->
                    <div class="properties-card">
                        <h4>Ticket properties</h4>
                        <div class="properties-grid">
                            <div class="property-item">
                                <label>Status</label>
                                <span class="property-value" id="modalTicketStatus">Open</span>
                            </div>
                            <div class="property-item">
                                <label>Priority</label>
                                <span class="property-value" id="modalTicketPriority">Normal</span>
                            </div>
                            <div class="property-item">
                                <label>Type</label>
                                <span class="property-value" id="modalTicketType">Question</span>
                            </div>
                            <div class="property-item">
                                <label>Created</label>
                                <span class="property-value" id="modalTicketCreatedDate">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Ticket Modal -->
    <div id="createTicketModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>
                    <i class="ph-light ph-ticket"></i>
                    Create New Service Ticket
                </h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createTicketForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="ticketCustomer">Customer *</label>
                        <select id="ticketCustomer" required>
                            <option value="">Select Customer</option>
                        </select>
                        <small class="form-help">Choose the customer for this service ticket</small>
                    </div>
                    <div class="form-group">
                        <label for="ticketType">Service Type</label>
                        <select id="ticketType">
                            <option value="IT Support">IT Support</option>
                            <option value="Hardware Repair">Hardware Repair</option>
                            <option value="Network Setup">Network Setup</option>
                            <option value="Software Installation">Software Installation</option>
                            <option value="Data Recovery">Data Recovery</option>
                            <option value="Consulting">Consulting</option>
                            <option value="Other">Other</option>
                        </select>
                        <small class="form-help">Select the type of service requested</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ticketTitle">Subject/Title *</label>
                    <input type="text" id="ticketTitle" required placeholder="Brief description of the issue or request">
                    <small class="form-help">Enter a clear, concise subject line (minimum 5 characters)</small>
                </div>
                
                <div class="form-group">
                    <label for="ticketDescription">Detailed Description *</label>
                    <textarea id="ticketDescription" required rows="6" placeholder="Provide detailed information about the issue, steps to reproduce, expected vs actual behavior, etc."></textarea>
                    <small class="form-help">Detailed description helps in faster resolution (minimum 20 characters)</small>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="ticketPriority">Priority Level</label>
                        <select id="ticketPriority">
                            <option value="low">🟢 Low - General inquiry or minor issue</option>
                            <option value="normal" selected>🟡 Normal - Standard support request</option>
                            <option value="high">🟠 High - Important business impact</option>
                            <option value="urgent">🔴 Urgent - Critical system down</option>
                        </select>
                        <small class="form-help">Select priority based on business impact</small>
                    </div>
                    <div class="form-group">
                        <label for="ticketStatus">Initial Status</label>
                        <select id="ticketStatus">
                            <option value="new" selected>New - Just created, needs review</option>
                            <option value="in_progress">In Progress - Currently being worked on</option>
                        </select>
                        <small class="form-help">Set the initial status for this ticket</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ticketNotes">Internal Staff Notes</label>
                    <textarea id="ticketNotes" rows="3" placeholder="Internal notes, assignment details, or additional context (not visible to customer)"></textarea>
                    <small class="form-help">These notes are only visible to staff members</small>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="ticketAssignToMe">
                        <span>Assign this ticket to me</span>
                    </label>
                    <small class="form-help">Check this box to automatically assign the ticket to yourself</small>
                </div>
                
                <div class="form-submit">
                    <div class="form-submit-info">
                        <small>Customer will be notified via email when the ticket is created</small>
                    </div>
                    <div class="form-submit-actions">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('createTicketModal').style.display = 'none'">
                            <i class="ph-light ph-x"></i>
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="ph-light ph-plus"></i>
                            Create Ticket
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact Details Modal -->
    <div id="contactDetailsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Contact Submission Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="contactDetailsContent">
                <!-- Contact details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-client.js"></script>
    <script src="js/admin-auth.js"></script>
    <script src="js/admin-dashboard.js"></script>
</body>
</html> 